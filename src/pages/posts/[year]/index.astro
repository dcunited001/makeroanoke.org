---
import { type CollectionEntry, getCollection } from 'astro:content';
import { loadAndFormatCollection } from '@/lib/utils.ts';

import Layout from '@/layouts/Base.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Navbar from '@/components/Navbar.astro';

import PostCard from '@/components/post/Card.astro';
import SubNavbar from '@/components/SubNavbar.astro';

import { Debug } from 'astro:components';

export async function getStaticPaths() {
  const posts = await loadAndFormatCollection('posts');
  return posts.map((post) => ({
    params: { year: post.year, month: post.month, slug: post.slug },
    props: post,
  }));
}

const pageTitle = 'Posts';
const pageDescription = 'Articles from makers in Roanoke.';
const params = Astro.params;

// TODO: refactor repetition for year/month (also in utils.js)
const posts = (await getCollection('posts')).filter(
  (p) => p.data.pubDate.getFullYear().toString() == params.year).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

---
<Layout title={pageTitle} description={pageDescription}>
  <SubNavbar slot="subnav" />

  <style is:global>
    main {
      width: 960px;
    }
    ul.card-list {
      display: flex;
      flex-wrap: wrap;

      list-style-type: none;
      margin: 0;
      padding: 0;
    }
    ul.card-list li {
      width: calc(50% - 1rem);
      margin: 0.5rem;
    }
    ul.card-list li * {
      text-decoration: none;
      transition: 0.2s ease;
    }
    ul.card-list li img {
      margin-bottom: 0.5rem;
      border-radius: 12px;
    }
    ul.card-list li a {
      display: block;
    }
    ul.card-list li a:hover h4,
    ul li a:hover .date {
      color: rgb(var(--accent));
    }
    ul.card-list a:hover img {
      box-shadow: var(--box-shadow);
    }
    @media (max-width: 720px) {
      ul.card-list {
        gap: 0.5em;
      }
      ul.card-list li {
        width: 100%;
        text-align: center;
      }
    }
  </style>

  <section>
    <ul class="card-list">
      {posts.map((post) => <PostCard post={post} />)}
    </ul>
  </section>
</Layout>
