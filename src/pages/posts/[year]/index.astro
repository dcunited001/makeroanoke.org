---
import { type CollectionEntry, getCollection } from 'astro:content';
import { loadAndFormatCollection } from '@/lib/utils.ts';

import Layout from '@/layouts/Base.astro';
import FormattedDate from '@/components/FormattedDate.astro';
import Navbar from '@/components/Navbar.astro';

import Layout from '@/layouts/Base.astro';
import SubNavbar from '@/components/SubNavbar.astro';
import PostList from '@/components/post/List.astro';

import { Debug } from 'astro:components';

export async function getStaticPaths() {
  const posts = await loadAndFormatCollection('posts');
  return posts.map((post) => ({
    params: { year: post.data.year, month: post.data.month, slug: post.slug },
    props: post,
  }));
}

const pageTitle = 'Posts';
const pageDescription = 'Articles from makers in Roanoke.';
const params = Astro.params;

// TODO: refactor repetition for year/month (also in utils.js)
const posts = (await getCollection('posts'))
  .filter((p) => p.data.pubDate.getFullYear().toString() == params.year)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title={pageTitle} description={pageDescription}>
  <SubNavbar slot="subnav" links={[]} />

  <PostList posts={posts} />
</Layout>
