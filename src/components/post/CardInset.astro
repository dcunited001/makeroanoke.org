---
import CategoryBadge from '@/components/category/Badge.astro';
import { getEntry, type CollectionEntry } from 'astro:content';
import FormattedDate from '../FormattedDate.astro';
import AvatarText from '../people/AvatarText.astro';

type Props = {
  post: CollectionEntry<'posts'>;
};
type Author = CollectionEntry<'people'>;
type Category = CollectionEntry<'category'>;
// type Tag = CollectionEntry<'tag'>;

const { post } = Astro.props;
const author: Author = await getEntry('people', post.data.author.id);
const category: Category = await getEntry('category', post.data.category.id);
---

<style>
  .title {
    margin: 0;
    color: rgb(var(--black));
    line-height: 1;
  }
  .date {
    margin: 0;
    color: rgb(var(--gray));
  }
</style>

<div
  class="rounded-lg border border-gray-200 bg-white shadow dark:border-gray-700 dark:bg-gray-800"
>
  <div class="relative start-0">
    <!-- max-w-sm -->
    <div class="overflow-hidden rounded-tr-lg">
      <a href={`/posts/${post.data.year}/${post.data.month}/${post.slug}/`}>
        <!-- width={720} height={360} -->
        <img src={post.data.heroImage} alt="" alt="" />
      </a>
    </div>

    <div
      class="absolute -bottom-3 -right-2 inline-flex space-x-3 rounded border-2 bg-white bg-opacity-75 p-1"
    >
      <div class="flex-auto self-start">
        <AvatarText person={author} size="24">
          <p class="date">
            <FormattedDate date={post.data.pubDate} />
          </p>
        </AvatarText>
      </div>
    </div>
    <div class="absolute -left-2 -top-2 flex-auto justify-self-end">
      <CategoryBadge category={category} />
    </div>
  </div>

  <div class="p-2">
    <a href={`/posts/${post.data.year}/${post.data.month}/${post.slug}/`}>
      <h5
        class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white"
      >
        {post.data.title}
      </h5>
    </a>
    <p class="mb-3 font-normal text-gray-700 dark:text-gray-400">
      {post.data.description}
    </p>

    <!-- mt-auto doesn't adjust height, which is set by  -->
    <span class="">
      <a
        href={`/posts/${post.data.year}/${post.data.month}/${post.slug}/`}
        class="inline-flex items-center rounded-lg bg-blue-700 px-3 py-2 text-center text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
      >
        Read more
        <svg
          class="ms-2 h-3.5 w-3.5 rtl:rotate-180"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 14 10"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M1 5h12m0 0L9 1m4 4L9 9"></path>
        </svg>
      </a>
    </span>
  </div>
</div>
