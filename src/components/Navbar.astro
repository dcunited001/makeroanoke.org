---
// import type { HTMLAttributes } from 'astro/types';
import { makeNavbarEntries, navbarConfig } from '@/components/schema';
import { relUrl } from '@/lib/utils';
import Icon from 'node_modules/astro-icon/components/Icon.astro';
// TODO: set aria-current

function markCurrent(path: string[], link: string[]) {
  return path[0] === link[0];
}

const navbarEntries = makeNavbarEntries(
  navbarConfig.items,
  Astro.url,
  markCurrent,
);
---

<nav class="bg-white border-gray-200">
  <!-- removed:  justify-between items-center  mx-auto  -->
  <div class="flex flex-wrap max-w-screen-xl p-4">
    <a href={relUrl()} class="flex items-center space-x-3 rtl:space-x-reverse">
      <img
        src={relUrl('MAKE_Roanoke_Logo.png')}
        class="h-8"
        alt="MAKE Roanoke Logo"
      />
    </a>

    <!-- TODO: fix flex placement of search icon -->
    <!-- aria-controls="search-form" -->
    <!-- HACK: mr-auto  -->
    <button
      type="button"
      class="p-2 mr-auto text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
      aria-expanded="false"
    >
      <span class="sr-only">Search not implemented</span>
      <Icon name="flowbite:search-outline" size="30" />
    </button>
    <button
      data-collapse-toggle="navbar-dropdown"
      type="button"
      class="inline-flex items-center p-2 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
      aria-controls="navbar-dropdown"
      aria-expanded="false"
    >
      <span class="sr-only">Open main menu</span>
      <Icon name="flowbite:bars-outline" size="30" />
    </button>

    <!-- HACK: ml-auto ... also probably a hack  -->
    <div class="hidden ml-auto w-full md:block md:w-auto" id="navbar-dropdown">
      <ul
        class="flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white"
      >
        {
          navbarEntries.map((entry) => (
            <li>
              {entry.isCurrent ? (
                <a
                  href={entry.href}
                  aria-current={entry.isCurrent && 'page'}
                  class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:p-0"
                >
                  {entry.label}
                </a>
              ) : (
                <a
                  href={entry.href}
                  class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0"
                >
                  {entry.label}
                </a>
              )}
            </li>
          ))
        }
        <!-- TODO: place search button -->
        <!-- <li>
          <button
            type="button"
            class="text-sm p-2 text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
            aria-controls="navbar-dropdown"
            aria-expanded="false"
          >
            <span class="sr-only">Search</span>
            <Icon name="flowbite:search-outline" />
          </button>
        </li> -->
      </ul>
    </div>
  </div>
</nav>
